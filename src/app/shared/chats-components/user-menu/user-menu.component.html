<div class="relative user-menu-container">
  <button
    class="w-8 h-8 bg-forest rounded-full flex items-center justify-center hover:bg-forest/90 transition-colors focus:outline-none focus:ring-2 focus:ring-forest focus:ring-offset-2"
    (click)="toggleMenu()" [attr.aria-expanded]="isOpen" aria-haspopup="true">
    <span class="text-white text-sm font-medium">{{ userInitials }}</span>
  </button>

  <div *ngIf="isOpen"
    class="absolute right-0 mt-2 w-56 bg-popover rounded-lg shadow-lg border border-border py-1 z-50 animate-in fade-in-0 zoom-in-95 duration-200"
    role="menu" aria-orientation="vertical">
    <div class="px-4 py-3 border-b border-border">
      <p class="text-sm font-medium text-popover-foreground">{{ userName }}</p>
      <p class="text-xs text-muted-foreground">{{ userEmail }}</p>
    </div>

    <div class="py-1">
      <button
        class="flex items-center w-full px-4 py-2 text-sm text-popover-foreground hover:bg-accent transition-colors"
        (click)="onProfileClick()" role="menuitem">
        <lucide-angular [img]="userIcon" class="w-4 h-4 mr-3 text-muted-foreground"></lucide-angular>
        Profile
      </button>

      <button
        class="flex items-center w-full px-4 py-2 text-sm text-popover-foreground hover:bg-accent transition-colors"
        (click)="onSettingsClick()" role="menuitem">
        <lucide-angular [img]="settingsIcon" class="w-4 h-4 mr-3 text-muted-foreground"></lucide-angular>
        Settings
      </button>

      <button
        class="flex items-center w-full px-4 py-2 text-sm text-popover-foreground hover:bg-accent transition-colors"
        (click)="onHelpClick()" role="menuitem">
        <lucide-angular [img]="helpIcon" class="w-4 h-4 mr-3 text-muted-foreground"></lucide-angular>
        Help & Support
      </button>
    </div>

    <div class="border-t border-border my-1"></div>
    <div class="py-1">
      <button
        class="flex items-center w-full px-4 py-2 text-sm text-destructive hover:bg-destructive/10 transition-colors"
        (click)="onSignOutClick()" role="menuitem">
        <lucide-angular [img]="logOutIcon" class="w-4 h-4 mr-3 text-destructive"></lucide-angular>
        Sign out
      </button>
    </div>
  </div>
</div>

<app-settings-modal
  [isOpen]="showSettingsModal"
  [userData]="currentUser"
  (closeModal)="onCloseSettingsModal()">
</app-settings-modal>
